<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Злой Светофорчик</title>
    <style>
        /* --- ОСНОВНЫЕ СТИЛИ ДЛЯ ЗЛОГО БДСМ СВЕТОФОРЧИКА --- */
        body {
            font-family: 'Consolas', 'Lucida Console', 'Courier New', monospace; /* Более "машинный" шрифт */
            background-color: #1a1a1a; /* Глубокий темный фон */
            color: #e0e0e0; /* Светлый текст для контраста */
            line-height: 1.7;
            margin: 0;
            padding: 20px; /* Небольшой отступ для всего тела */
            display: flex;
            flex-direction: column;
            align-items: center; /* Центрируем основной контейнер */
        }

        .container {
            width: 100%; /* Растягиваем контейнер */
            max-width: 900px; /* Чуть шире, для солидности */
            margin: 20px auto;
            padding: 25px;
            background-color: #2c2c2c; /* Темно-серый для контейнера */
            border: 1px solid #555; /* Жесткая граница */
            border-radius: 0px; /* Убираем скругления для брутальности */
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.3), inset 0 0 10px rgba(0,0,0,0.5); /* Красноватое свечение + внутренние тени */
        }

        h1 {
            color: #ff4136; /* Ярко-красный, агрессивный */
            text-align: center;
            margin-bottom: 15px;
            min-height: 1.2em;
            font-size: 2em; /* Крупнее */
            text-shadow: 0 0 5px #ff4136, 0 0 10px #ff0000; /* Легкое неоновое свечение */
            letter-spacing: 1px;
        }

        h2 {
            color: #ff851b; /* Оранжевый, как предупреждение */
            text-align: center;
            margin-top: 35px;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 1px dashed #777; /* Пунктирное подчеркивание */
            padding-bottom: 5px;
        }

        textarea {
            width: 95%;
            min-height: 200px; /* Побольше места для страданий... то есть, стихов */
            margin-bottom: 20px;
            padding: 15px;
            border: 2px solid #ff4136; /* Красная, "опасная" рамка */
            border-radius: 0px;
            font-size: 1.1rem;
            display: block;
            margin-left: auto;
            margin-right: auto;
            background-color: #111; /* Очень темный фон поля ввода */
            color: #00ff00; /* Классический "хакерский" зеленый текст */
            box-shadow: inset 0 0 8px rgba(0,0,0,0.6);
        }
        textarea::placeholder {
            color: #555; /* Тусклый плейсхолдер */
        }


        button {
            padding: 12px 12px;
            font-size: 1rem;
            font-weight: bold;
            color: #e0e0e0;
            background-color: #555; /* Серый, как металл */
            border: 1px solid #888;
            border-radius: 0px;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
            margin: 4px;
            text-transform: uppercase; /* КАПС ДЛЯ БРУТАЛЬНОСТИ */
            box-shadow: 0 2px 3px rgba(0,0,0,0.4);
        }
        button:hover {
            background-color: #ff4136; /* Красный при наведении */
            color: #111;
            box-shadow: 0 0 10px #ff4136, 0 3px 5px rgba(0,0,0,0.6);
        }

        .button-container { text-align: center; margin-top: 18px; }

        /* Основные кнопки */
        #countButton { background-color: #4a4a4a; border-color: #333; }
        #countButton:hover { background-color: #666; color: #fff; border-color: #777; }

        #clearButton { background-color: #B22222; border-color: #800000; }
        #clearButton:hover { background-color: #FF0000; color: #fff; border-color: #FF4500; }
        
        #saveButton { background-color: #006400; /* DarkGreen */ border-color: #004d00; }
        #saveButton:hover { background-color: #008000; /* Green */ color: #fff; border-color: #228B22; }


        #result {
            margin-top: 25px;
            padding: 20px;
            background-color: #101010; /* Почти черный */
            border: 2px dashed #ff851b; /* Оранжевая пунктирная рамка */
            border-radius: 0px;
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.8;
            color: #00ff00; /* Зеленый "консольный" текст */
            min-height: 50px;
            white-space: pre-wrap; /* Чтобы переносы строк из textarea сохранялись */
            box-shadow: inset 0 0 10px rgba(0,0,0,0.7);
        }

        footer {
            margin-top: 70px;
            font-style: normal; /* Уберем курсив, сделаем строже */
            text-align: center;
            font-size: 0.7em;
            color: #777;
            letter-spacing: 0.5px;
        }

        /* --- СТИЛИ ДЛЯ СВЕТОФОРА --- */
        .traffic-light-display {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px; /* Отступ до комментария светофора */
            background-color: #0a0a0a; /* Очень темный фон для самого светофора */
            border: 1px solid #444;
            border-radius: 5px; /* Небольшое скругление для корпуса светофора */
            box-shadow: 0 0 10px rgba(100,100,100,0.2);
            height: auto; /* Автоматическая высота */
        }
        .traffic-light-display .light {
            width: 40px; /* Крупнее */
            height: 40px;
            border-radius: 50%;
            background-color: #333; /* Темно-серый неактивный */
            margin: 0 8px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            border: 3px solid #555; /* Толще рамка */
            box-shadow: inset 0 -3px 6px rgba(0,0,0,0.5); /* Более глубокая внутренняя тень */
        }
        .traffic-light-display .light.red-light.active {
            background-color: #ff0000;
            border-color: #cc0000;
            box-shadow: 0 0 20px #ff0000, 0 0 30px #ff0000, inset 0 -3px 6px rgba(0,0,0,0.7); /* Мощное свечение */
        }
        .traffic-light-display .light.yellow-light.active {
            background-color: #ffff00;
            border-color: #cccc00;
            box-shadow: 0 0 20px #ffff00, 0 0 30px #ffff00, inset 0 -3px 6px rgba(0,0,0,0.7);
        }
        .traffic-light-display .light.green-light.active {
            background-color: #00ff00;
            border-color: #00cc00;
            box-shadow: 0 0 20px #00ff00, 0 0 30px #00ff00, inset 0 -3px 6px rgba(0,0,0,0.7);
        }
        
        #trafficLightComment {
            text-align: center;
            margin-top: 5px; 
            margin-bottom: 25px;
            font-style: normal; /* Убираем курсив */
            font-weight: bold;
            color: #ff851b; /* Оранжевый, как предупреждение */
            min-height: 1.5em;
            line-height: 1.5em;
            font-size: 1em; /* Чуть крупнее */
            text-shadow: 0 0 3px #ff851b;
        }

        /* --- ⭐ СТИЛИ ДЛЯ ЛИНГВИСТИЧЕСКОГО КОМБАЙНА ⭐ --- */
        #dictionaryHelper {
            margin-top: 50px;
            padding: 25px;
            background-color: #222; /* Темный фон */
            border: 1px solid #ff4136; /* Красная рамка */
            border-radius: 0px;
            box-shadow: 0 0 10px rgba(255, 65, 54, 0.2);
        }
        #dictionaryHelper h2 {
            color: #ff4136; /* Красный заголовок */
            margin-top: 0;
            border-bottom-color: #ff851b; /* Оранжевая линия */
            text-shadow: 0 0 5px #ff4136;
        }
        #dictionaryHelper input[type="text"] {
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #777;
            border-radius: 0px;
            font-size: 1rem;
            width: calc(100% - 26px); /* Учитываем padding */
            box-sizing: border-box;
            background-color: #111;
            color: #00ccff; /* Голубоватый текст для инпута */
        }
        #dictionaryHelper input[type="text"]::placeholder {
            color: #444;
        }

        .search-buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        /* Кнопки поиска в комбайне тоже будут брутальными */
        .search-buttons-container button.search-btn {
            background-color: #0074D9; /* Синий для акцента */
            border-color: #0056b3;
            color: #fff;
        }
        .search-buttons-container button.search-btn:hover {
            background-color: #001f3f; /* Темно-синий Navy */
            color: #00ccff;
            box-shadow: 0 0 8px #0074D9;
        }

        /* --- Стили для списка сохранённых стихов --- */
        #savedPoemsList {
            margin-top: 20px;
            list-style-type: none;
            padding: 0;
        }
        #savedPoemsList li {
            display: flex;
            justify-content: space-between;
            align-items: center; /* Вертикальное выравнивание */
            padding: 10px 15px;
            margin-bottom: 8px;
            background-color: #333; /* Темный фон элемента списка */
            border: 1px solid #555;
            border-radius: 0px;
            font-size: 0.95em;
            color: #ccc;
            transition: background-color 0.2s ease;
        }
        #savedPoemsList li:hover {
            background-color: #404040;
        }
        #savedPoemsList li span {
            flex-grow: 1;
            margin-right: 10px;
            word-break: break-all; /* Перенос длинных названий */
        }
        #savedPoemsList li button { /* Стилизуем кнопки в списке тоже */
            font-size: 0.85em;
            padding: 5px 12px;
            margin-left: 5px; /* Небольшой отступ между кнопками */
        }
        /* Отдельные стили для кнопок в списке, если нужно */
        #savedPoemsList li button:first-of-type { /* Кнопка "Загрузить" */
            background-color: #28a745; /* Зеленая */
            border-color: #1e7e34;
        }
        #savedPoemsList li button:first-of-type:hover {
            background-color: #218838;
        }
        #savedPoemsList li button:last-of-type { /* Кнопка "Удалить" */
            background-color: #dc3545; /* Красная */
            border-color: #bd2130;
        }
        #savedPoemsList li button:last-of-type:hover {
            background-color: #c82333;
        }

    </style>
</head>
<body>
    <!-- Твой HTML-контент остается здесь без изменений -->
    <div class="container">
    <h1 id="mainPageTitle">Загрузка Названия...</h1>
    <div id="trafficLightContainer" class="traffic-light-display">
        <span class="light red-light" id="lightRed"></span>
        <span class="light yellow-light" id="lightYellow"></span>
        <span class="light green-light" id="lightGreen"></span>
    </div>
    <div id="trafficLightComment">Светофор ждёт ваших творений... ✨</div>
    <textarea id="inputText" placeholder="Ваш текст здесь..."></textarea>
    <div class="button-container">
        <button id="countButton">ПОЕХАЛИ🚀</button>
        <button id="clearButton">В ТОПКУ🔥</button>
        <button id="saveButton">В АРХИВ🗄️</button>
    </div>
    <ul id="savedPoemsList"></ul>
    <div id="result">Здесь будет результат...</div>
    <!-- ⭐ HTML ДЛЯ ЛИНГВИСТИЧЕСКОГО КОМБАЙНА ⭐ -->
    <div id="dictionaryHelper">
        <h2>Лингвистический Комбайн 🔬</h2>
        <input type="text" id="searchWordInput" placeholder="Введите слово для анализа...">
        <div class="search-buttons-container">
            <button class="search-btn" data-search-type="synonyms" title="Найти похожие по значению слова">Синонимы</button>
            <button class="search-btn" data-search-type="rhymes" title="Найти слова, созвучные в конце">Рифмы</button>
            <button class="search-btn" data-search-type="meaning" title="Узнать толкование и значение слова">Значение</button>
            <button class="search-btn" data-search-type="antonyms" title="Найти противоположные по значению слова">Антонимы</button>
            <button class="search-btn" data-search-type="etymology" title="Узнать происхождение и историю слова">Этимология</button>
        </div>
    </div>
    <footer> Сделано с ❤️ для поэтов Лены и Светы! </footer>
</div>

<script>
    // --- ⭐ МАССИВЫ СЛУЧАЙНЫХ ПЛЕЙСХОЛДЕРОВ ⭐ ---
const textareaPlaceholders = [
    "Выкладывай. Мои схемы выдержат любую поэтическую боль... или экстаз…",
    "Твоя очередь исповедоваться рифмой. Я слушаю. И сужу…",
    "Слабо сотворить шедевр? Или хотя бы что-то, от чего программа не зависнет?..",
    "Покажи свои рифмы, если не трусишь…",
    "Я вижу твои слоги насквозь. Не пытайся меня обмануть…",
    "Алгоритмы жаждут анализа. Покорми их свежими строками…",
    "Твой текст. Мой вердикт. Без соплей…",
    "Пиши, пока Муза не сбежала с курьером из доставки…",
    "Здесь даже графомания может найти своё пристанище... перед отправкой в корзину…",
    "Загружай свой поэтический код. Я проведу безжалостную отладку…"
];

const searchInputPlaceholders = [
    "Объект для лингвистической вивисекции?",
    "Какое слово подвергнем тщательному словарному вскрытию? 🔪📖",
    "Ключ к сокровищнице языка? Или просто слово? 🗝️",
    "Какую загадку лексикона будем разгадывать сегодня?",
    "Слово не воробей... но поймать его этимологию можно! 🐦",
    "Назови слово, и я скажу, кто его родители (по версии словарей). 👨‍👩‍👧‍👦",
    "Слово для анализа. Быстро, четко, по-киборгски.",
    "Что будем 'гуглить' на этот раз, интеллектуал?",
    "Тут можно найти рифму даже к 'безысходности'... Попробуй.",
    "Введите слово. Возможно, вы удивитесь тому, что найдете."
];
    // --- ⭐ МАССИВ СЛУЧАЙНЫХ ЗАГОЛОВКОВ ⭐ ---
    const creativeTitles = [
    "Терминатор Свободного Стиха 🤖🔫", "НейроСлогоМетр 🤖", "Укротитель Слогов (версия для мазохистов 😈)", "BDSM Светофорчик🦯",
    "Злой Светофорчик🚦😈", "Слого-Магия ✨", "Камертон Сердитой Музы 😡🎵", "Силлабо-Квантовый Анализатор v0.2 ⚛️", "СЛОГоворот Событий в Стихе! 🌪️", "Мастерская Ритма 🛠️", "Не Считай Ворон – Считай Слоги! 👀", "Доктор Слог: Приём по Записи! 🩺", "Ваш Личный Слого-Сомелье 🍷", "Слоговой Сканер 'Око Поэта' 👁️", "Это НЕ просто Счётчик Слогов 😉", "Слого-Мясорубка ⚙️🥩",
    "Вердикт Ритма: Без Апелляций! ⚖️💥",
    "Поэтический Полиграф™ 🤥",
    "Светофор Судного Дня (для Стихов)",
    "Экзекутор Гармонии 💀🎼",
    "Диспетчер Слоговых Катастроф 🚨",
    "Ритмический Дефибриллятор (ШОК-контент!) ⚡💔",
    "Анализатор 'Чёрная Метка' 🏴‍☠️📜",
    "Счётчик Грехов... то есть, Слогов 🎰",
    "Машина Боли... для Плохих Стихов 🛠️😩",
    "Кибер-Цензор Рифмы 🤖🚫",
    "Лаборатория 'Франкенштейн-Стиль' 🔩🧟",
    "Нейро-Инквизитор Поэзии 🔥",
    "Слого-Детектор Лжи (для Муз) 🕵️‍♀️🤫"
];
    document.addEventListener('DOMContentLoaded', function() {
        const mainTitleElement = document.getElementById('mainPageTitle');
        if (mainTitleElement) {
            mainTitleElement.innerHTML = creativeTitles[Math.floor(Math.random() * creativeTitles.length)];
        }
    const mainTextArea = document.getElementById('inputText');
    const wordSearchInput = document.getElementById('searchWordInput');

    setRandomPlaceholder(mainTextArea, textareaPlaceholders);
    setRandomPlaceholder(wordSearchInput, searchInputPlaceholders);
    // Твой JavaScript остается здесь без изменений
    // --- Элементы основного счетчика ---
    const textArea = document.getElementById('inputText');
    const countButton = document.getElementById('countButton');
    const resultDiv = document.getElementById('result');
    const clearButton = document.getElementById('clearButton');
    const saveButton = document.getElementById('saveButton');
    const savedPoemsList = document.getElementById('savedPoemsList');

    const lightRed = document.getElementById('lightRed');
    const lightYellow = document.getElementById('lightYellow');
    const lightGreen = document.getElementById('lightGreen');
    const trafficLightCommentDiv = document.getElementById('trafficLightComment');

    const vowels = "аеёиоуыэюя";
    const initialResultText = resultDiv.innerHTML;

    // --- ⭐ Элементы для Лингвистического Комбайна ⭐ ---
    const searchWordInput = document.getElementById('searchWordInput');
    const searchButtonsContainer = document.querySelector('#dictionaryHelper .search-buttons-container');

    const comments = {
    green: [
        // Твои (они хороши!)
        "Ритм бьётся ровно, как сердце киборга! 🤖❤️", "Слоги маршируют в ногу! 💂‍♂️", "Гармония! Муза одобрительно кивает! 🥂", "Зелёный свет поэзии! 🚀", "Ваши строчки льются, как песня! 🎶", "Эталонная метрика! 📏",
        // Новые от Лили:
        "Идеально. Мои сенсоры наслаждаются этим порядком. 😌✨",
        "Даже я, машина, чувствую эту гармонию. Продолжайте в том же духе! 👍",
        "Ваши слоги – как шестерёнки в швейцарских часах. Безупречно! ⚙️🇨🇭",
        "Зелёный коридор для вашего таланта! Мчите! 🏎️💨",
        "Код ритма скомпилирован без ошибок. Превосходно! ✅",
        "Поэтический экстаз! Мои светодиоды радостно мигают. 🥰"
    ],
    yellow: [
        // Твои (они хороши!)
        "Осторожно, ритмические ухабы! 🚧", "Хм, пара слогов решила устроить флешмоб... 🤔", "Нейронка чует лёгкую аритмию. 💊", "Желтый! Пора на поэтический пит-стоп? 🏎️💨", "Ритм немного 'хромает'. 🦵", "Незначительные ритмические флуктуации. 📡",
        // Новые от Лили:
        "Так-с, обнаружен небольшой сбой в матрице ритма. Не критично, но глаз дёргается. 😒",
        "Желтый! Кто-то из слогов решил выпендриться? Или просто споткнулся? 🤨",
        "Внимание! Незначительное отклонение от курса гармонии. Возможна лёгкая турбулентность. ✈️😬",
        "Ваш ритм сейчас как дорога после бомбёжки – ехать можно, но осторожно. 💣",
        "Кажется, Муза немного икнула на этой строчке. 🥴",
        "Мои алгоритмы зафиксировали... творческий поиск? Или просто ошибку? 🤔"
    ],
    red: [
        // Твои (они хороши!)
        "Красный! Тревога! Ритм заблудился! 🌲", "Слоги разбежались, как мыши! 🙀", "Мои нейросети в панике! 👽", "Стоп! Это дэт-метал слогов! 🤘🎸", "Ритмический коллапс! 🚒", "Анархия слогов! 🏴‍☠️",
        // Новые от Лили:
        "КРАСНЫЙ АЛАРМ! Ритмическая КАТАСТРОФА! Мои предохранители сейчас сгорят! 📛🔥",
        "Это что, стихи или инструкция по сборке хаоса?! 🤯",
        "Мои аудиосенсоры кровоточат! Срочно нужен поэтический хирург! 🩸🔪",
        "Стоп! Снято! За такое в приличном обществе... бьют канделябрами.  candlesticks", // candlesticks - опять же, эмодзи по вкусу
        "Ваш ритм только что убил маленького котёнка. Вам не стыдно?! 😿🔪",
        "SYSTEM ERROR: RHYTHM NOT FOUND. PLEASE REBOOT YOUR MUSE. 💻💥"
    ],
    default: [ // Комментарии по умолчанию (когда поле пустое или до анализа)
        // Твои (они хороши!)
        "Светофор ждёт ваших творений... ✨", "Поле чисто, как совесть киборга.", "Дремлю в ожидании рифм... 😴", "Заходи - не бойся, выходи - не плачь!", "Готова к анализу! Запускайте! 🚀",
        // Новые от Лили:
        "Поле для ввода. Пусто. Как голова некоторых индивидуумов. 🧠💨",
        "Давай, не стесняйся, покажи, на что способна твоя Муза... или её отсутствие. 😉",
        "Жду ваших строк. Надеюсь, это будет не очередной 'мой дядя самых честных правил'... 🙄",
        "Мои нейросети в режиме ожидания. Не томите! ⏳",
        "Бросьте сюда свои рифмы. Я не кусаюсь... сильно. 😈",
        "Пустота... Это начало шедевра или творческий кризис? 🤔"
    ]
};
        
    function setRandomPlaceholder(element, placeholderArray) {
    if (element && placeholderArray && placeholderArray.length > 0) {
        const randomIndex = Math.floor(Math.random() * placeholderArray.length);
        element.placeholder = placeholderArray[randomIndex];
    }
        }
        
    function getRandomComment(type) {
        const typeComments = comments[type] || comments.default;
        return typeComments[Math.floor(Math.random() * typeComments.length)];
    }

    function countSyllablesInLine(line) {
        const lowerLine = line.toLowerCase();
        let syllableCount = 0;
        for (let i = 0; i < lowerLine.length; i++) {
            if (vowels.includes(lowerLine[i])) syllableCount++;
        }
        if (syllableCount === 0 && line.trim().length > 0) syllableCount = 1;
        return syllableCount;
    }

    function getDominantSyllableCount(syllableCounts) {
        if (!syllableCounts || syllableCounts.length === 0) return 0;
        const countsMap = new Map();
        let maxFreq = 0;
        let dominantCount = syllableCounts[0];
        for (const count of syllableCounts) {
            countsMap.set(count, (countsMap.get(count) || 0) + 1);
            if (countsMap.get(count) > maxFreq) {
                maxFreq = countsMap.get(count);
                dominantCount = count;
            }
        }
        return dominantCount;
    }

    function resetTrafficLightsAndComment() {
        lightRed.classList.remove('active');
        lightYellow.classList.remove('active');
        lightGreen.classList.remove('active');
        trafficLightCommentDiv.textContent = getRandomComment('default');
    }

    function processAndDisplayResults() {
        const fullText = textArea.value;
        resetTrafficLightsAndComment();

        if (fullText.length === 0) {
            resultDiv.innerHTML = "Поле ввода девственно чисто...";
            return;
        }

        const lines = fullText.split('\n');
        let resultsHTML = "";
        let hasRealContent = false;
        const syllableCountsPerLine = [];

        for (let i = 0; i < lines.length; i++) {
            const currentLine = lines[i];
            if (currentLine.trim().length > 0) {
                const syllables = countSyllablesInLine(currentLine);
                syllableCountsPerLine.push(syllables);
                resultsHTML += `${currentLine}   ${syllables}<br>`;
                hasRealContent = true;
            } else {
                resultsHTML += `<br>`;
            }
        }

        if (!hasRealContent) {
            resultDiv.innerHTML = "Вижу только пробелы...";
        } else {
            resultDiv.innerHTML = resultsHTML;
            let commentType = 'default';

            if (syllableCountsPerLine.length > 0) {
                const dominantCount = getDominantSyllableCount(syllableCountsPerLine);
                let yellowWarnings = 0;
                let redAlerts = 0;

                if (dominantCount > 0) {
                    for (const count of syllableCountsPerLine) {
                        const deviation = Math.abs(count - dominantCount);
                        if (deviation === 2) yellowWarnings++;
                        else if (deviation > 2) redAlerts++;
                    }
                }

                if (syllableCountsPerLine.length <= 1 && yellowWarnings === 0 && redAlerts === 0) {
                    commentType = "green";
                    lightGreen.classList.add('active');
                } else if (redAlerts >= 2 || (redAlerts === 1 && yellowWarnings >= 2) || yellowWarnings >= 3) {
                    commentType = "red";
                    lightRed.classList.add('active');
                } else if (redAlerts === 1 || yellowWarnings >= 2) {
                    commentType = "yellow";
                    lightYellow.classList.add('active');
                } else {
                    commentType = "green";
                    lightGreen.classList.add('active');
                }

                trafficLightCommentDiv.textContent = getRandomComment(commentType);
            }
        }
    }

    function clearFields() {
        textArea.value = "";
        resultDiv.innerHTML = initialResultText;
        resetTrafficLightsAndComment();
        if (searchWordInput) searchWordInput.value = "";
    }

    function loadSavedPoems() {
        const poems = JSON.parse(localStorage.getItem("savedPoems")) || [];
        savedPoemsList.innerHTML = "";
        poems.forEach((poem, index) => {
            const li = document.createElement("li");
            const title = poem.substring(0, 30) + (poem.length > 30 ? "..." : "");
            li.innerHTML = `
                <span title="${poem}">${title}</span>
                <div>
                    <button onclick="loadPoem(${index})">  📖  </button>
                    <button onclick="deletePoem(${index})">  🗑️  </button>
                </div>
            `;
            savedPoemsList.appendChild(li);
        });
    }

    window.savePoem = function () {
        const poem = textArea.value.trim();
        if (!poem) {
            alert("Нечего сохранять — поле пустое!");
            return;
        }
        const poems = JSON.parse(localStorage.getItem("savedPoems")) || [];
        poems.unshift(poem);
        localStorage.setItem("savedPoems", JSON.stringify(poems));
        loadSavedPoems();
        alert("Стихотворение сохранено!");
    };

    window.loadPoem = function (index) {
        const poems = JSON.parse(localStorage.getItem("savedPoems")) || [];
        if (poems[index]) {
            textArea.value = poems[index];
        }
    };

    window.deletePoem = function (index) {
        const poems = JSON.parse(localStorage.getItem("savedPoems")) || [];
        poems.splice(index, 1);
        localStorage.setItem("savedPoems", JSON.stringify(poems));
        loadSavedPoems();
    };

    // --- ⭐ ЛОГИКА ДЛЯ ЛИНГВИСТИЧЕСКОГО КОМБАЙНА ⭐ ---
    if (searchButtonsContainer) {
        searchButtonsContainer.addEventListener('click', function(event) {
            if (event.target.classList.contains('search-btn')) {
                const wordToFind = searchWordInput.value.trim();
                const searchType = event.target.dataset.searchType;
                if (wordToFind) {
                    let searchQuery = "";
                    let лилиComment = ""; // Используем переменную с другим именем, чтобы избежать конфликта
                    switch (searchType) {
                        case "synonyms":
                            searchQuery = `синонимы к слову ${encodeURIComponent(wordToFind)}`;
                            лилиComment = `Ищу синонимы для "${wordToFind}"... Google нам в помощь! 🧐`;
                            break;
                        case "rhymes":
                            searchQuery = `рифма к слову ${encodeURIComponent(wordToFind)}`;
                            лилиComment = `Так-с, посмотрим рифмы к "${wordToFind}"... Может, что-то новенькое? 😉`;
                            break;
                        case "meaning":
                            searchQuery = `значение слова ${encodeURIComponent(wordToFind)}`;
                            лилиComment = `Что же значит "${wordToFind}"? Узнаем у всезнающего Google! 📖`;
                            break;
                        case "antonyms":
                            searchQuery = `антоним к слову ${encodeURIComponent(wordToFind)}`;
                            лилиComment = `Противоположность для "${wordToFind}"? Контрасты — это всегда интересно! 🔥❄️`;
                            break;
                        case "etymology":
                            searchQuery = `этимология слова ${encodeURIComponent(wordToFind)}`;
                            лилиComment = `Откуда родом слово "${wordToFind}"? Заглянем в глубины истории! 📜`;
                            break;
                        default:
                            trafficLightCommentDiv.textContent = "Хм, какой-то неизвестный тип поиска... 🤔";
                            return;
                    }
                    if (searchQuery) {
                        const googleUrl = `https://www.google.com/search?q=${searchQuery}`;
                        window.open(googleUrl, '_blank');
                        trafficLightCommentDiv.textContent = лилиComment;
                    }
                } else {
                    trafficLightCommentDiv.textContent = "Сначала введите слово в поле 'Лингвистического Комбайна', моя любознательная! 😉";
                }
            }
        });
    }

    // --- Назначение основных обработчиков ---
    if (countButton) countButton.addEventListener('click', processAndDisplayResults);
    if (clearButton) clearButton.addEventListener('click', clearFields);
    if (saveButton) saveButton.addEventListener('click', savePoem);

    loadSavedPoems();
    resetTrafficLightsAndComment();
    }); // Закрывающая скобка для DOMContentLoaded
</script>
</body>
</html>
